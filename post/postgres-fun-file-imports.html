<!DOCTYPE html><html lang="en-US"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>Postgres Fun: Using File Import | SPD Blog</title><meta name="description" content="First in PostgreSQL Series, using files to manage DB."/><meta property="og:type" content="website"/><meta name="og:title" property="og:title" content="Postgres Fun: Using File Import"/><meta name="og:description" property="og:description" content="First in PostgreSQL Series, using files to manage DB."/><meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Postgres Fun: Using File Import"/><meta name="twitter:description" content="First in PostgreSQL Series, using files to manage DB."/><meta name="twitter:creator"/><link rel="icon" type="image/png" href="/static/favicon.ico"/><link rel="apple-touch-icon" href="/static/favicon.ico"/><meta name="next-head-count" content="13"/><link rel="preload" href="/blog/_next/static/css/d3b0ff999e614dc807d6.css" as="style"/><link rel="stylesheet" href="/blog/_next/static/css/d3b0ff999e614dc807d6.css"/><link rel="preload" href="/blog/_next/static/css/bd9d9c26e848ad9998be.css" as="style"/><link rel="stylesheet" href="/blog/_next/static/css/bd9d9c26e848ad9998be.css"/><link rel="preload" href="/blog/_next/static/chunks/main-3426d16b71b08bec2947.js" as="script"/><link rel="preload" href="/blog/_next/static/chunks/webpack-488dc228921f1fdbc0e7.js" as="script"/><link rel="preload" href="/blog/_next/static/chunks/framework.a5d4ffe593e18b49243e.js" as="script"/><link rel="preload" href="/blog/_next/static/chunks/b59e6658.acdc88755e55ded238c8.js" as="script"/><link rel="preload" href="/blog/_next/static/chunks/commons.31bdf4c1b63891aa4bfa.js" as="script"/><link rel="preload" href="/blog/_next/static/chunks/pages/_app-21c7a7a663f3cc7fee82.js" as="script"/><link rel="preload" href="/blog/_next/static/chunks/1173eff4538ab0eae4f3f506dea9a7965770ad37.ff9aca2ce00f65120db1.js" as="script"/><link rel="preload" href="/blog/_next/static/chunks/pages/post/%5Bslug%5D-87e3a2ae1cb2ab3e35b1.js" as="script"/></head><body><div id="__next"><div class="max-w-screen-sm px-4 py-12 mx-auto antialiased font-body"><header><h1 class="mb-2"><a class="text-2xl font-black text-black no-underline font-display" href="/blog">Some Thoughts</a></h1></header><main><article><header class="mb-8"><h1 class="mb-2 text-6xl font-black leading-none font-display">Postgres Fun: Using File Import</h1><p class="text-sm">September 5, 2020</p></header><div class="mb-4 prose-sm prose sm:prose lg:prose-lg"><p>At The Climate Service (TCS), our relational database (DB) of choice is (PostgreSQL)<a href="pg">https://www.postgresql.org/</a>. Before joining TCS, my experience had only been with NoSQL DBs, namely (MongoDB)<a href="">https://www.mongodb.com/</a>. It has been a journey so far to delve into everything that pg offers, I&#x27;ll be sharing some of what I&#x27;ve found to be useful over the course of several entries.</p><h3>TLDR</h3><p>We are able to import DB data from files (assumes you have (Docker)<a href="">https://docs.docker.com/get-docker/</a>/(psql)<a href="">https://www.postgresql.org/download/</a> installed):</p><ul><li>Clone and cd into this repo: <code>git clone XYZ &amp;&amp; cd XYZ</code></li><li>Start a local (pg instance with Docker)<a href="">https://hub.docker.com/_/postgres</a>: <code>docker run --name some-postgres -e POSTGRES_PASSWORD=mysecretpassword -d postgres</code></li><li>Connect using psql: <code>psql -h localhost -p 5432 -U postgres -W</code></li><li>Create a schema and tables using file import: <code>\i db/schema.ddl</code></li><li>&quot;Seed&quot; tables using file import: <code>\i db/seed.sql</code></li></ul><h2>Schema Management</h2><p>If, like us at TCS, you employ methods like Agile/SCRUM, then your team is looking to build out feature sets through iteration. For us, as part of building &quot;Generation 2.0&quot; of our product, much of that also occurred within our DB schema, as our researchers continue to grow their own knowledge base surrounding the relationships between climate science and risk.</p><p>For the first few months, as we built out our DB schema, and tested how we modeled the relationships behind our data, we would pack everything in two files - gracefully named <code>schema.dll</code> and <code>seed.sql</code>. We had these under source control, so we could at least look back at changes to our git repository and understand the journey to now. This was due to our team&#x27;s decision to not use an object-relational mapping library (such as (Sequelize)<a href="">https://sequelize.org/</a> or (TypeORM)<a href="">https://typeorm.io/</a> in relational-DB land, or an object data modeling (ODM) such as (Mongoose)<a href="">https://mongoosejs.com/</a> for the NoSQL-inclined) to start, to give us better flexibility while in this learning-by-doing period.</p><p>In practice this meant that any pull request (PR) with schema changes would lead to something like the following for each developer, first within one&#x27;s local pg instance, subsequently as part of our build pipeline:</p><pre style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>&gt; docker start local-postgres     #restart pg container, if process had been shut down.
</span>&gt; psql local-postgres      #connect to docker pg instance using `psql` utility
<!-- -->&gt; \i path/to/schema.dll     #import latest/greatest DB schema from file
<!-- -->&gt; \i path/to/seed.sql       #import latest/greatest DB seed data from file
</code></pre><p>When I first started using this method, it blew my mind! Some of our more senior engineers were starting to discuss, and implement, infrastructure-as-code (IaC), but I had originally thought without the use of an ORM we&#x27;d receive DB updates through Slack and ad hoc document/update ourselves organically. Thankfully livelier minds were driving our project.</p><h2>Next Steps, An Invitation to Migration</h2><p>As you may have surmised, while this was great as we were ramping up, it quickly became a hinderance to have our DB - even a local Docker instance - doing its best phoenix impression whenever we added even a simple field to a table. Thankfully, our team now uses (Flyway)<a href="">https://flywaydb.org/getstarted/why</a> - so whenever Alice heads out on vacation, and Bob finishes his design for a time-saving DB trigger, Alice can quickly and safely update. All it takes is a <code>git pull</code> on our trunk branch, and a <code>flyway migrate</code> thereafter.</p><p>More on that to come! Does your team struggle with or have a great method for relational DB management?</p><h2>That&#x27;s it! Happy coding!</h2></div><hr class="mt-4"/><footer><div class="flex items-center mt-8 mb-16"><img class="lazyload blur-up flex-shrink-0 mb-0 mr-3 rounded-full w-18 h-16" alt="Profile" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAICAYAAADA+m62AAAAAklEQVR4AewaftIAAADySURBVE3BvU7CUACG4fccTgGLQESNkGh0cJDExcUYL8A78C7d3N2dHFz8GwwJKqQlAUtpQ8/5jIOJz2OSzw8ZazHGMHp6YHx/y/Diiq3hJUhI4pdFQBCLWcLs7obzo2N6eUIxfeePJKwQQvhiycqLte2A69LK5vxnJVAQzkTE3jJ5faGe55hmC0lIQhLWhIAQzZ1d3MkpaToimzwzJ0IhoCAIwklCgsViyeN3l25WUjZ6VM0ezjawfo2hwoUQmM49b18l+UafzbNrxlpRsx0Gtk6tFuHLAjfLCtIq5uBwQH9/j+WqxLVjttsNvKAKhsI7fgCuWoInGNIgygAAAABJRU5ErkJggg==" data-srcset="/blog/_next/static/images/profile-c2be2d422988d6577a1b39ccdb31661b.png"/><p class="text-base leading-7">Hello there! I&#x27;m <b class="font-semibold">Sean</b>,<!-- --> <!-- -->a software engineer at The Climate Service, though my background is in finance and consulting.<!-- --> <br/><a href="https://linkedin.com/in/spdolan">Connect with me on LinkedIn.</a></p></div></footer></article><nav class="flex justify-between mb-10"><a class="text-lg font-bold" href="/blog/post/intent">‚Üê <!-- -->Intent</a><div></div></nav></main><footer class="text-lg font-light">¬© <!-- -->2020<!-- -->, Built with<!-- --> <a href="https://nextjs.org/">Next.js</a>üî•</footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"frontmatter":{"title":"Postgres Fun: Using File Import","date":"September 5, 2020","modified":"September 5, 2020","description":"First in PostgreSQL Series, using files to manage DB.","tags":["postgresql","fresh-dev"]},"post":{"content":"\nAt The Climate Service (TCS), our relational database (DB) of choice is (PostgreSQL)[https://www.postgresql.org/] (pg). Before joining TCS, my experience had only been with NoSQL DBs, namely (MongoDB)[https://www.mongodb.com/]. It has been a journey so far to delve into everything that pg offers, I'll be sharing some of what I've found to be useful over the course of several entries.\n\n### TLDR\n\nWe are able to import DB data from files (assumes you have (Docker)[https://docs.docker.com/get-docker/]/(psql)[https://www.postgresql.org/download/] installed):\n\n- Clone and cd into this repo: `git clone XYZ \u0026\u0026 cd XYZ`\n- Start a local (pg instance with Docker)[https://hub.docker.com/_/postgres]: `docker run --name some-postgres -e POSTGRES_PASSWORD=mysecretpassword -d postgres`\n- Connect using psql: `psql -h localhost -p 5432 -U postgres -W`\n- Create a schema and tables using file import: `\\i db/schema.ddl`\n- \"Seed\" tables using file import: `\\i db/seed.sql`\n\n## Schema Management\n\nIf, like us at TCS, you employ methods like Agile/SCRUM, then your team is looking to build out feature sets through iteration. For us, as part of building \"Generation 2.0\" of our product, much of that also occurred within our DB schema, as our researchers continue to grow their own knowledge base surrounding the relationships between climate science and risk.\n\nFor the first few months, as we built out our DB schema, and tested how we modeled the relationships behind our data, we would pack everything in two files - gracefully named `schema.dll` and `seed.sql`. We had these under source control, so we could at least look back at changes to our git repository and understand the journey to now. This was due to our team's decision to not use an object-relational mapping library (such as (Sequelize)[https://sequelize.org/] or (TypeORM)[https://typeorm.io/] in relational-DB land, or an object data modeling (ODM) such as (Mongoose)[https://mongoosejs.com/] for the NoSQL-inclined) to start, to give us better flexibility while in this learning-by-doing period.\n\nIn practice this meant that any pull request (PR) with schema changes would lead to something like the following for each developer, first within one's local pg instance, subsequently as part of our build pipeline:\n\n```console\n\u003e docker start local-postgres     #restart pg container, if process had been shut down.\n\u003e psql local-postgres      #connect to docker pg instance using `psql` utility\n\u003e \\i path/to/schema.dll     #import latest/greatest DB schema from file\n\u003e \\i path/to/seed.sql       #import latest/greatest DB seed data from file\n```\n\nWhen I first started using this method, it blew my mind! Some of our more senior engineers were starting to discuss, and implement, infrastructure-as-code (IaC), but I had originally thought without the use of an ORM we'd receive DB updates through Slack and ad hoc document/update ourselves organically. Thankfully livelier minds were driving our project.\n\n## Next Steps, An Invitation to Migration\n\nAs you may have surmised, while this was great as we were ramping up, it quickly became a hinderance to have our DB - even a local Docker instance - doing its best phoenix impression whenever we added even a simple field to a table. Thankfully, our team now uses (Flyway)[https://flywaydb.org/getstarted/why] - so whenever Alice heads out on vacation, and Bob finishes his design for a time-saving DB trigger, Alice can quickly and safely update. All it takes is a `git pull` on our trunk branch, and a `flyway migrate` thereafter.\n\nMore on that to come! Does your team struggle with or have a great method for relational DB management?\n\n## That's it! Happy coding!\n","excerpt":""},"previousPost":{"slug":"intent","frontmatter":{"title":"Intent","date":"August 30, 2020","modified":"September 5, 2020","description":"Let's get inside, out.","tags":["self-accountability"]},"excerpt":"","content":"\n### I'll be writing here about building things with code, or other things that I've found to be interesting or of use.\n\n#### Upcoming writings\n\n- Using Tekton CLI\n- Small JS Patterns\n  - [x] Config Object\n- Postgres Fun\n  - [x] File Imports\n  - [ ] File Exports\n  - [ ] \"Beanstalk\" Tables\n  - [ ] Common Table Expressions\n  - [ ] Generating Tables and Triggers\n  - [ ] Methods to Soft Delete\n- Small Refactorings\n- Transition to Cypress\n- Using Cypress Commands\n"},"nextPost":null},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"postgres-fun-file-imports"},"buildId":"oOI8uRw2ZM0FOAtUx6gRs","assetPrefix":"/blog","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/blog/_next/static/chunks/polyfills-9a32872f6a983227f3b1.js"></script><script src="/blog/_next/static/chunks/main-3426d16b71b08bec2947.js" async=""></script><script src="/blog/_next/static/chunks/webpack-488dc228921f1fdbc0e7.js" async=""></script><script src="/blog/_next/static/chunks/framework.a5d4ffe593e18b49243e.js" async=""></script><script src="/blog/_next/static/chunks/b59e6658.acdc88755e55ded238c8.js" async=""></script><script src="/blog/_next/static/chunks/commons.31bdf4c1b63891aa4bfa.js" async=""></script><script src="/blog/_next/static/chunks/pages/_app-21c7a7a663f3cc7fee82.js" async=""></script><script src="/blog/_next/static/chunks/1173eff4538ab0eae4f3f506dea9a7965770ad37.ff9aca2ce00f65120db1.js" async=""></script><script src="/blog/_next/static/chunks/pages/post/%5Bslug%5D-87e3a2ae1cb2ab3e35b1.js" async=""></script><script src="/blog/_next/static/oOI8uRw2ZM0FOAtUx6gRs/_buildManifest.js" async=""></script><script src="/blog/_next/static/oOI8uRw2ZM0FOAtUx6gRs/_ssgManifest.js" async=""></script></body></html>